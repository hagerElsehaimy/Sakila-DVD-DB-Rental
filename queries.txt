### Q1 show Total rental for each category

SELECT c.name As category,
COUNT(*) As rental_count
FROM inventory i
JOIN rental r
ON i.inventory_id=r.inventory_id
JOIN film f
ON i.film_id=f.film_id
JOIN film_category fc
ON fc.film_id=f.film_id
JOIN category c
ON c.category_id=fc.category_id
GROUP BY category
ORDER BY rental_count DESC;

### Q2  How much did our top customers pay in each month?

SELECT c.first_name, c.last_name,
       DATE_PART('YEAR',p.payment_date)AS payment_year,TO_CHAR(
    TO_DATE (DATE_PART('MONTH',p.payment_date)::text, 'MM'), 'Month'
    ) AS payment_month,SUM(p.amount) AS monthly_total_payment
   FROM customer c
   JOIN payment p
   ON c.customer_id=p.customer_id
   GROUP BY c.first_name, 
       c.last_name, payment_year,payment_month
   ORDER BY SUM(p.amount) DESC
   LIMIT 10;


### Q3 rental variation between stores

SELECT s.store_id,DATE_PART('YEAR',rental_date)AS rental_year,TO_CHAR(
    TO_DATE (DATE_PART('MONTH',rental_date)::text, 'MM'), 'Month'
    ) AS rental_month,count(*) AS rental_count
 FROM store s
 JOIN staff sf
 USING(store_id)
 JOIN rental r
 USING(staff_id)
 GROUP BY store_id,rental_month,rental_year
 ORDER BY rental_count DESC;

###Q4 Revenue per countries

SELECT co.country,SUM(p.amount) AS country_revenue
FROM country co
JOIN city ci
USING(country_id)
JOIN address ad
USING(city_id)
JOIN customer cu
USING(address_id)
JOIN payment p
USING (customer_id)
GROUP BY co.country
ORDER BY country_revenue DESC;